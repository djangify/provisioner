{% extends "portal/base.html" %}
{% block title %}Custom Domain | My Djangify{% endblock %}

{% block content %}
<h1 class="text-2xl font-semibold mb-4">Custom Domain</h1>

<div id="domain-status" class="mb-4 text-sm"></div>

<div class="space-y-4">
    <input
        id="domain-input"
        type="text"
        placeholder="example.com"
        class="border rounded px-3 py-2 w-full max-w-md"
    />

    <div class="mt-4 flex flex-wrap gap-3">
        <button
            type="button"
            id="save-domain"
            style="background:#111;color:#fff;padding:10px 16px;border-radius:6px;"
        >
            Save domain
        </button>

        <button
            type="button"
            id="verify-domain"
            style="background:#444;color:#fff;padding:10px 16px;border-radius:6px;"
        >
            Verify & activate
        </button>

        <button
            type="button"
            id="remove-domain"
            style="background:#b91c1c;color:#fff;padding:10px 16px;border-radius:6px;"
        >
            Remove
        </button>
    </div>

</div>

<script>
const statusBox = document.getElementById("domain-status");

function setStatus(msg, ok=true) {
    statusBox.textContent = msg;
    statusBox.className = ok ? "text-green-600 mb-4 text-sm" : "text-red-600 mb-4 text-sm";
}

document.getElementById("save-domain").onclick = async () => {
    const domain = document.getElementById("domain-input").value.trim();
    
    if (!domain) {
        setStatus("Please enter a domain", false);
        return;
    }
    
    setStatus("Saving...");
    
    const res = await fetch("/portal/api/domain/set/", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({ domain })
    });

    const data = await res.json();
    if (data.success) {
        setStatus(data.instructions || "Domain saved. Click 'Verify & activate' when DNS is configured.");
    } else {
        setStatus(data.error || "Failed to save domain", false);
    }
};

document.getElementById("verify-domain").onclick = async () => {
    setStatus("Checking DNS and setting up SSL... This may take a minute.");
    
    const res = await fetch("/portal/api/domain/verify/", { method: "POST" });
    const data = await res.json();
    
    if (data.success) {
        setStatus("Domain is live with HTTPS!");
    } else {
        setStatus(data.error || "Verification failed", false);
    }
};

document.getElementById("remove-domain").onclick = async () => {
    if (!confirm("Remove custom domain? Your subdomain will continue to work.")) {
        return;
    }
    
    setStatus("Removing...");
    
    const res = await fetch("/portal/api/domain/remove/", { method: "POST" });
    const data = await res.json();
    
    if (data.success) {
        setStatus("Custom domain removed.");
        document.getElementById("domain-input").value = "";
    } else {
        setStatus(data.error || "Failed to remove domain", false);
    }
};
</script>
{% endblock %}